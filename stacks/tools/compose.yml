services:
  # Traefik - Reverse proxy for subdomain routing
  traefik:
    image: traefik:v3.6
    container_name: traefik
    command:
      - --api.dashboard=true
      - --api.insecure=true
      - --providers.docker=true
      - --providers.docker.exposedbydefault=false
      - --providers.docker.network=tools_tools-network
      - --entrypoints.web.address=:80
      - --log.level=INFO
    ports:
      - "80:80"
      - "8080:8080"
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock:ro
    networks:
      - tools-network
    restart: always
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.dashboard.rule=Host(`traefik.${DOMAIN:-tools.tap}`)"
      - "traefik.http.routers.dashboard.service=api@internal"
      - "traefik.http.routers.dashboard.entrypoints=web"
      # Homepage auto-discovery labels
      - "homepage.server=tools"
      - "homepage.group=Tools"
      - "homepage.name=Traefik"
      - "homepage.icon=traefik.png"
      - "homepage.href=http://traefik.${DOMAIN:-tools.tap}"
      - "homepage.description=Reverse Proxy"
      - "homepage.widget.type=traefik"
      - "homepage.widget.url=http://traefik:8080"

  # Termix - SSH/Server management web UI
  termix:
    image: ghcr.io/lukegus/termix:latest
    container_name: termix
    environment:
      - PORT=8080
      - TZ=${TZ:-America/Toronto}
    volumes:
      - ./config/termix:/app/data
    networks:
      - tools-network
    restart: unless-stopped
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.termix.rule=Host(`ssh.${DOMAIN:-tools.tap}`)"
      - "traefik.http.routers.termix.entrypoints=web"
      - "traefik.http.services.termix.loadbalancer.server.port=8080"
      # Homepage auto-discovery labels
      - "homepage.server=tools"
      - "homepage.group=Tools"
      - "homepage.name=Termix"
      - "homepage.icon=terminal.png"
      - "homepage.href=http://ssh.${DOMAIN:-tools.tap}"
      - "homepage.description=SSH Web UI"

  # Homepage - Homelab dashboard with multi-server support
  homepage:
    image: ghcr.io/gethomepage/homepage:latest
    container_name: homepage
    environment:
      - TZ=${TZ:-America/Toronto}
      - HOMEPAGE_ALLOWED_HOSTS=home.${DOMAIN:-tools.tap}
    volumes:
      - ./config/homepage:/app/config
      - /var/run/docker.sock:/var/run/docker.sock:ro
    networks:
      - tools-network
    restart: unless-stopped
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.homepage.rule=Host(`home.${DOMAIN:-tools.tap}`)"
      - "traefik.http.routers.homepage.entrypoints=web"
      - "traefik.http.services.homepage.loadbalancer.server.port=3000"
      # Homepage auto-discovery labels
      - "homepage.server=tools"
      - "homepage.group=Tools"
      - "homepage.name=Homepage"
      - "homepage.icon=homepage.png"
      - "homepage.description=Homelab Dashboard"

  # Stirling PDF - PDF manipulation toolkit
  stirling-pdf:
    image: docker.stirlingpdf.com/stirlingtools/stirling-pdf:latest
    container_name: stirling-pdf
    environment:
      - DOCKER_ENABLE_SECURITY=false
      - INSTALL_BOOK_AND_ADVANCED_HTML_OPS=false
      - TZ=${TZ:-America/Toronto}
    volumes:
      - ./config/stirling-pdf/trainingData:/usr/share/tessdata
      - ./config/stirling-pdf/configs:/configs
      - ./config/stirling-pdf/logs:/logs
    networks:
      - tools-network
    restart: unless-stopped
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.stirling-pdf.rule=Host(`pdf.${DOMAIN:-tools.tap}`)"
      - "traefik.http.routers.stirling-pdf.entrypoints=web"
      - "traefik.http.services.stirling-pdf.loadbalancer.server.port=8080"
      # Homepage auto-discovery labels
      - "homepage.server=tools"
      - "homepage.group=Tools"
      - "homepage.name=Stirling PDF"
      - "homepage.icon=stirling-pdf.png"
      - "homepage.href=http://pdf.${DOMAIN:-tools.tap}"
      - "homepage.description=PDF Toolkit"

networks:
  tools-network:
    driver: bridge
